<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ITS A DEAL – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
</head>
<body class="app-main">
  <h1>Admin Panel</h1>

  <section class="card" id="loginBox">
    <h2>כניסת אדמין</h2>
    <p>הכנס סיסמת אדמין כדי לראות את כל המשתמשים והדילים.</p>
    <input id="adminPass" type="password" placeholder="סיסמת אדמין">
    <button id="loginBtn" class="btn primary">כניסה</button>
    <p id="adminError" class="status-message error"></p>
  </section>

  <section class="card" id="adminContent" style="display:none;">
    <h2>מצב מערכת</h2>
    <h3>משתמשים</h3>
    <pre id="usersList" style="white-space:pre-wrap; font-size:12px;"></pre>
    <h3>דילים</h3>
    <pre id="tradesList" style="white-space:pre-wrap; font-size:12px;"></pre>
  </section>

<script>
  async function adminLogin() {
    const password = document.getElementById("adminPass").value;
    const res = await fetch("/api/admin/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ password })
    });

    const data = await res.json();
    if (!data.ok) {
      document.getElementById("adminError").textContent = "סיסמה שגויה";
      return;
    }

    loadAdminData(password);
  }

  async function loadAdminData(password) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminContent").style.display = "block";

    const res = await fetch("/api/admin/state?password=" + encodeURIComponent(password));
    const data = await res.json();

    document.getElementById("usersList").textContent =
      JSON.stringify(data.users, null, 2);
    document.getElementById("tradesList").textContent =
      JSON.stringify(data.trades, null, 2);
  }

  document.getElementById("loginBtn").onclick = adminLogin;
</script>
</body>
</html>
